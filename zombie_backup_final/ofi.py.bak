# rtai/indicators/ofi.py
"""
OFI Oscillator - Order Flow Imbalance come RSI-like
=================================================

Trasforma OFI in oscillatore 0-100 stabile con estremi rari ma significativi.
"""

from rtai.indicators.filters import Oscillator
from rtai.config import INDICATORS

class OFIOsc:
    """OFI trasformato in oscillatore RSI-like"""
    
    def __init__(self, **kwargs):
        # Usa parametri specifici per OFI dalla config
        params = {**INDICATORS["ofi"], **kwargs}
        self.osc = Oscillator(**params)
        self.last_raw = 0.0

    def on_minute(self, ofi_raw_minute):
        """
        Processa OFI aggregato per minuto
        
        Args:
            ofi_raw_minute: Somma OFI sui 60s (o media) -> un valore/minuto
            
        Returns:
            Dict con valori OFI processati
        """
        if ofi_raw_minute is None:
            ofi_raw_minute = 0.0
            
        self.last_raw = ofi_raw_minute
        rsi_like, z, zf = self.osc.step(ofi_raw_minute)
        
        return {
            "ofi_raw": ofi_raw_minute,
            "ofi_z": z,
            "ofi_zf": zf,
            "ofi_rsi": rsi_like,   # 0..100
        }
